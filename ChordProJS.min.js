(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z=function(a,b){function c(){this.constructor=a}for(var d in b)A.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},A={}.hasOwnProperty;h="else",r=function(){function a(a,b){this.name=a,this.conditions=[],this.conditionCount=0,b.call(this)}return a.prototype.on=function(a,b){return this.conditions[this.conditionCount++]=new q(a,b)},a.prototype["else"]=function(a){return this.on(h,a)},a}(),q=function(){function a(a,b){this.condition=a,this.callback=b}return a}(),p=function(){function a(){this.waitForExpr=null,this.states={},this.namelessConditionIndex=0,this.currentState=null}return a.prototype.debugging=!1,a.prototype.waitFor=function(a){this.waitForExpr=a},a.prototype.error=function(a){return console.error(a)},a.prototype.debug=function(a,b){var c;for(c=0;c++<b;)a="    "+a;return this.debugging?console.log(a):void 0},a.prototype.handleWaitForExpr=function(a){return this.testCondition(this.waitForExpr,a)?(this.debug("was waiting for "+this.waitForExpr+", now found",1),this.waitForExpr=null):this.debug("still waiting for "+this.waitForExpr,1)},a.prototype["char"]=function(a){return"\n"===a?"<NEW LINE>":" "===a?"<SPACE>":a},a.prototype.parse=function(a){var b,c,d;for(c=0,d=a.length;d>c;c++)b=a[c],this.debug(this["char"](b)+" #####"),this.waitForExpr?this.handleWaitForExpr(b):(this.debug("No expression to wait for, testing conditions",1),this.testConditions(b))},a.prototype.getNewState=function(a,b){var c;return(c=b.call(this,a))&&c&&c!==this.currentState&&c instanceof r?this.currentState=c:null},a.prototype.transitionTo=function(a){return this.states[a]},a.prototype.testConditions=function(a){var b,c,d,e,f;for(f=this.currentState.conditions,c=0,d=f.length;d>c;c++)if(b=f[c],this.debug("condition "+b.condition,1),this.testCondition(b.condition,a))return this.debug("matches condition, calling callback "+b.callback,2),void((e=this.getNewState(a,b.callback))?this.debug("new state: "+e.name,1):this.debug("state remains "+this.currentState.name,1));return this.debug("did not match any condition. State remains "+this.currentState.name,1)},a.prototype.testCondition=function(a,b){if(a===h)return this.debug("Condition is ELSE conditions, so condition matches",3),!0;if(a instanceof RegExp){if(a.test(b))return this.debug(b+" matches regex "+a,3),!0}else if("string"==typeof a){if(a===b)return this.debug(b+" equals string "+this["char"](a),3),!0}else this.debug("Unrecognized condition "+a,3);return!1},a.prototype.state=function(a,b){var c;return void 0===typeof c&&"object"==typeof a&&(c=a,a=null),this.states[a]=new r(a,b)},a}(),n="\n",y=/\s/,v=/[a-z]/i,w=/[^\}]/,b=/[a-g]/i,c=/#|b/,a="/",t="[",s="]",f="{",e="}",d=":",l=/[^\n\{\}\[\]]/,g=window.ChordProJS={},k=function(){function a(){this.chords="",this.lyrics=""}return a}(),m=function(){function a(){this.items=[],this.currentItem=null}return a.prototype.addItem=function(){var a;return a=new k,this.items.push(a),this.currentItem=a},a}(),u=function(){function a(){this.lines=[],this.currentLine=null}return a.prototype.chords=function(a){return this.currentLine.currentItem.chords+=a},a.prototype.lyrics=function(a){return this.currentLine||this.addLine(),this.currentLine.currentItem.lyrics+=a},a.prototype.addLine=function(){var a;return a=new m,this.lines.push(a),this.currentLine=a,a.addItem()},a.prototype.addItem=function(){return this.currentLine?this.currentLine.addItem():this.addLine()},a}(),o=function(a){function b(){b.__super__.constructor.call(this),this.song=new u,this.tagName="",this.tagValue="",this.currentState=this.state("readLyrics",function(){return this.on(n,function(){return this.song.addLine()}),this.on(t,function(){return this.song.addItem(),this.transitionTo("readChords")}),this.on(f,function(){return this.transitionTo("readTagName")}),this["else"](function(a){return this.song.lyrics(a)})}),this.state("readChords",function(){return this.on(n,function(){}),this.on(t,function(){}),this.on(s,function(){return this.transitionTo("readLyrics")}),this["else"](function(a){return this.song.chords(a)})}),this.state("readTagName",function(){return this.on(d,function(){return this.transitionTo("readTagValue")}),this.on(e,function(){return this.finishTag(),this.transitionTo("readLyrics")}),this["else"](function(a){return this.tagName+=a})}),this.state("readTagValue",function(){return this.on(e,function(){return this.finishTag(),this.transitionTo("readLyrics")}),this["else"](function(a){return this.tagValue+=a})})}return z(b,a),b.prototype.finishTag=function(){return this.debug("TAG: "+this.tagName+" = "+this.tagValue),this.tagName=this.tagValue=""},b.prototype.parse=function(a){return b.__super__.parse.call(this,a),this.song},b}(p),i=function(){function a(){this.stringOutput=""}return a.prototype.output=function(a){return this.stringOutput+=a},a.prototype.format=function(a){var b,c,d,e,f,g,h,i;for(h=a.lines,b=0,e=h.length;e>b;b++)for(g=h[b],this.newLine(),i=g.items,d=0,f=i.length;f>d;d++)c=i[d],this.formatItem(c);return this.endOfSong(),this.stringOutput},a}(),x=function(a){function b(){b.__super__.constructor.call(this),this.dirtyLine=!1,this.chordsLine="",this.lyricsLine=""}return z(b,a),b.prototype.finishLine=function(){var a;return a="",this.chordsLine.trim().length&&(a+=this.chordsLine+n),a+=this.lyricsLine+n,this.output(a),this.chordsLine="",this.lyricsLine=""},b.prototype.endOfSong=function(){return this.dirtyLine?this.finishLine():this.output(n)},b.prototype.newLine=function(){return this.dirtyLine?this.finishLine():void 0},b.prototype.padString=function(a,b){for(;a.length<b;)a+=" ";return a},b.prototype.formatItem=function(a){var b,c;return b=a.chords.length,b&&b++,c=Math.max(b,a.lyrics.length),this.chordsLine+=this.padString(a.chords,c),this.lyricsLine+=this.padString(a.lyrics,c),this.dirtyLine=!0},b}(i),j=function(a){function b(){b.__super__.constructor.call(this),this.dirtyLine=!1,this.lineEmpty=!0,this.chordsLine="",this.lyricsLine=""}var c;return z(b,a),c="&nbsp;",b.prototype.formatItem=function(a){var b,d;return b=a.chords.trim(),d=a.lyrics.trim(),(b.length||d.length)&&(b.length>d.length?b+=c:d.length>b.length&&(d+=c),this.chordsLine+=this.cell("chord",b),this.lyricsLine+=this.cell("lyrics",d)),this.dirtyLine=!0},b.prototype.finishLine=function(){var a;return a=this.row(this.chordsLine)+this.row(this.lyricsLine),this.output(this.table(a)),this.chordsLine="",this.lyricsLine=""},b.prototype.newLine=function(){return this.dirtyLine?this.finishLine():void 0},b.prototype.endOfSong=function(){return this.dirtyLine?this.finishLine():void 0},b.prototype.cell=function(a,b){return'<td class="'+a+'">'+b+"</td>"},b.prototype.row=function(a){var b;return b=a?"":' class="empty-line"',"<tr"+b+">"+a+"</tr>"},b.prototype.table=function(a){return"<table>"+a+"</table>"},b}(i),this.ChordProJS={Parser:o,Song:u,TextFormatter:x,HtmlFormatter:j}}).call(this);